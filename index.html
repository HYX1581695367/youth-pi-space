<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>装备部件团支部青年π空间</title>  
    <script src="https://cdn.tailwindcss.com"></script>  
    
    <!-- 使用 CDN 方式加载 Supabase -->  
    <script src="https://unpkg.com/@supabase/supabase-js@2.38.4/dist/umd/supabase.js"></script>  
</head>  
<body class="bg-gray-100">  
    <div class="min-h-screen flex flex-col">  
        <!-- 导航栏 -->  
        <nav class="bg-blue-600 text-white shadow-lg">  
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">  
                <h1 class="text-2xl font-bold">装备部件团支部青年π空间</h1>  
                <div id="userNav" class="hidden">  
                    <div class="flex items-center space-x-3">  
                        <img id="navUserAvatar" class="w-8 h-8 rounded-full object-cover" src="https://via.placeholder.com/32" alt="用户头像">  
                        <span id="navUserName">加载中...</span>  
                        <button id="editProfileBtn" class="px-3 py-1 bg-blue-500 rounded hover:bg-blue-600">编辑信息</button>  
                    </div>  
                </div>  
            </div>  
        </nav>  

        <!-- 主内容区 -->  
        <div class="container mx-auto px-4 py-6 flex-grow">  
            <!-- 首次访问输入信息表单 -->  
            <div id="userInfoContainer" class="bg-white shadow-md rounded-lg p-6 max-w-md mx-auto my-10">  
                <h2 class="text-xl font-semibold mb-4 text-center">欢迎使用青年π空间</h2>  
                <p class="text-gray-600 mb-6 text-center">请输入您的基本信息，系统将自动记住</p>  
                <div class="space-y-4">  
                    <div>  
                        <label class="block text-gray-700 mb-1">姓名</label>  
                        <input id="userName" type="text" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入姓名">  
                    </div>  
                    <div>  
                        <label class="block text-gray-700 mb-1">工号</label>  
                        <input id="userEmployeeId" type="text" class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入工号">  
                    </div>  
                    <div>  
                        <label class="block text-gray-700 mb-1">头像</label>  
                        <input id="userAvatar" type="file" accept="image/*" class="w-full">  
                    </div>  
                    <div class="flex justify-center">  
                        <button id="saveUserInfoBtn" class="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">保存并继续</button>  
                    </div>  
                </div>  
            </div>  

            <!-- 主要内容区 -->  
            <div id="mainContainer" class="hidden">  
                <!-- 板块导航 -->  
                <div class="bg-white shadow-md rounded-lg p-4 mb-6">  
                    <div class="flex space-x-4">  
                        <button data-section="tech" class="section-btn px-4 py-2 rounded bg-blue-500 text-white">技术问题板块</button>  
                        <button data-section="daily" class="section-btn px-4 py-2 rounded bg-gray-200">日常问题板块</button>  
                        <button data-section="user" class="section-btn px-4 py-2 rounded bg-gray-200">用户板块</button>  
                    </div>  
                </div>  

                <!-- 技术问题和日常问题板块 -->  
                <div id="techSection" class="section-content">  
                    <h2 class="text-xl font-bold mb-4">技术问题板块</h2>  
                    <div class="post-form bg-white shadow-md rounded-lg p-4 mb-6">  
                        <textarea id="techPostContent" class="w-full p-3 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3" rows="3" placeholder="分享你的技术问题..."></textarea>  
                        <div class="flex items-center mb-3">  
                            <label class="mr-2 text-gray-600">添加图片:</label>  
                            <input id="techPostImage" type="file" accept="image/*">  
                        </div>  
                        <button id="techPostBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">发布</button>  
                    </div>  
                    <div id="techPosts" class="space-y-6"></div>  
                </div>  

                <div id="dailySection" class="section-content hidden">  
                    <h2 class="text-xl font-bold mb-4">日常问题板块</h2>  
                    <div class="post-form bg-white shadow-md rounded-lg p-4 mb-6">  
                        <textarea id="dailyPostContent" class="w-full p-3 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3" rows="3" placeholder="分享你的日常问题..."></textarea>  
                        <div class="flex items-center mb-3">  
                            <label class="mr-2 text-gray-600">添加图片:</label>  
                            <input id="dailyPostImage" type="file" accept="image/*">  
                        </div>  
                        <button id="dailyPostBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">发布</button>  
                    </div>  
                    <div id="dailyPosts" class="space-y-6"></div>  
                </div>  

                <!-- 用户板块 -->  
                <div id="userSection" class="section-content hidden">  
                    <h2 class="text-xl font-bold mb-4">个人中心</h2>  
                    <div class="bg-white shadow-md rounded-lg p-6 mb-6">  
                        <div class="flex items-center space-x-4 mb-6">  
                            <div class="relative group">  
                                <img id="profileAvatar" class="w-20 h-20 rounded-full object-cover" src="https://via.placeholder.com/80" alt="用户头像">  
                                <div class="absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition cursor-pointer" id="changeAvatarBtn">  
                                    <span class="text-white text-xs">更换头像</span>  
                                </div>  
                                <input type="file" id="avatarInput" class="hidden" accept="image/*">  
                            </div>  
                            <div>  
                                <h3 id="profileName" class="text-xl font-semibold">加载中...</h3>  
                                <p class="text-gray-600">工号: <span id="profileEmployeeId">加载中...</span></p>  
                                <p id="adminBadge" class="hidden text-xs bg-red-500 text-white px-2 py-0.5 rounded inline-block mt-1">管理员</p>  
                            </div>  
                        </div>  
                        <div class="space-y-3">  
                            <div>  
                                <label class="block text-gray-700 mb-1">修改姓名</label>  
                                <div class="flex">  
                                    <input id="newName" type="text" class="flex-grow px-4 py-2 border rounded-l focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="输入新的姓名">  
                                    <button id="updateNameBtn" class="px-4 py-2 bg-blue-500 text-white rounded-r hover:bg-blue-600">更新</button>  
                                </div>  
                            </div>  
                            <div>  
                                <label class="block text-gray-700 mb-1">修改工号</label>  
                                <div class="flex">  
                                    <input id="newEmployeeId" type="text" class="flex-grow px-4 py-2 border rounded-l focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="输入新的工号">  
                                    <button id="updateEmployeeIdBtn" class="px-4 py-2 bg-blue-500 text-white rounded-r hover:bg-blue-600">更新</button>  
                                </div>  
                            </div>  
                        </div>  
                    </div>  

                    <h3 class="text-lg font-semibold mb-3">我的发布记录</h3>  
                    <div id="userPosts" class="space-y-6"></div>  
                </div>  
            </div>  
        </div>  
        
        <!-- 页脚 -->  
        <footer class="bg-gray-800 text-white py-4 mt-auto">  
            <div class="container mx-auto px-4 text-center">  
                <p>装备部件团支部青年π空间 &copy; 2025</p>  
            </div>  
        </footer>  
    </div>  

    <!-- 模板 -->  
    <template id="postTemplate">  
        <div class="post bg-white shadow-md rounded-lg p-4">  
            <div class="flex items-start space-x-3 mb-3">  
                <img class="post-avatar w-10 h-10 rounded-full object-cover" src="https://via.placeholder.com/40" alt="用户头像">  
                <div>  
                    <div class="flex items-center space-x-2">  
                        <h3 class="post-author font-semibold"></h3>  
                        <span class="post-admin-badge hidden text-xs bg-red-500 text-white px-1 rounded">管理员</span>  
                    </div>  
                    <p class="post-time text-gray-500 text-sm"></p>  
                </div>  
            </div>  
            <p class="post-content mb-3"></p>  
            <div class="post-image-container mb-3 hidden">  
                <img class="post-image max-h-96 rounded" alt="发布的图片">  
            </div>  
            <div class="flex items-center space-x-4 text-gray-500">  
                <button class="like-btn flex items-center space-x-1 hover:text-blue-500">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">  
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />  
                    </svg>  
                    <span class="like-count">0</span>  
                </button>  
                <button class="delete-btn hidden text-red-500 hover:text-red-700">删除</button>  
            </div>  
        </div>  
    </template>  

    <script>  
        // 错误消息显示元素  
        const errorContainer = document.createElement('div');  
        errorContainer.style.cssText = 'position:fixed;bottom:10px;left:10px;background:rgba(220,38,38,0.9);color:white;padding:10px;border-radius:4px;z-index:9999;max-width:80%;';  
        errorContainer.classList.add('hidden');  
        document.body.appendChild(errorContainer);  

        function showError(message) {  
            errorContainer.textContent = message;  
            errorContainer.classList.remove('hidden');  
            setTimeout(() => {  
                errorContainer.classList.add('hidden');  
            }, 5000);  
        }  

        // 管理员工号列表  
        const ADMIN_EMPLOYEE_IDS = ['admin001', 'admin002'];  

        // 当前用户对象  
        let currentUser = null;  
        let isAdmin = false;  
        let supabase = null;  

        // 初始化Supabase  
        function initSupabase() {  
            try {  
                if (typeof supabase !== 'object') {  
                    const SUPABASE_URL = 'https://hunzuynmgdhqvjvyztwq.supabase.co';   
                    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1bnp1eW5tZ2RocXZqdnl6dHdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4ODI1MzAsImV4cCI6MjA1ODQ1ODUzMH0.5ls_OU8cBVh-4AdLkohYKCrBYr_ITMybaY53iQZP1WI';  
                    
                    if (typeof window.supabase?.createClient === 'function') {  
                        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);  
                        console.log('Supabase 初始化成功');  
                    } else {  
                        console.error('Supabase 客户端加载失败');  
                        showError('系统初始化失败，请刷新页面重试');  
                    }  
                }  
            } catch (error) {  
                console.error('初始化 Supabase 出错:', error);  
                showError('系统初始化失败：' + error.message);  
            }  
        }  

        // 页面加载完成后初始化  
        document.addEventListener('DOMContentLoaded', () => {  
            console.log('页面加载完成');  
            
            // 初始化Supabase客户端  
            initSupabase();  

            // 检查本地存储中是否有用户信息  
            loadUserFromLocalStorage();  

            // 保存用户信息按钮  
            document.getElementById('saveUserInfoBtn').addEventListener('click', saveUserInfo);  

            // 编辑信息按钮  
            document.getElementById('editProfileBtn').addEventListener('click', showUserInfoForm);  

            // 板块切换  
            document.querySelectorAll('.section-btn').forEach(btn => {  
                btn.addEventListener('click', () => {  
                    const sectionId = btn.dataset.section;  
                    
                    // 更新按钮样式  
                    document.querySelectorAll('.section-btn').forEach(b => {  
                        if (b.dataset.section === sectionId) {  
                            b.classList.add('bg-blue-500', 'text-white');  
                            b.classList.remove('bg-gray-200');  
                        } else {  
                            b.classList.remove('bg-blue-500', 'text-white');  
                            b.classList.add('bg-gray-200');  
                        }  
                    });  
                    
                    // 显示对应板块内容  
                    document.querySelectorAll('.section-content').forEach(content => {  
                        content.classList.add('hidden');  
                        if (content.id === `${sectionId}Section`) {  
                            content.classList.remove('hidden');  
                        }  
                    });  
                });  
            });  

            // 发布帖子  
            document.getElementById('techPostBtn')?.addEventListener('click', () => createPost('tech'));  
            document.getElementById('dailyPostBtn')?.addEventListener('click', () => createPost('daily'));  

            // 更换头像  
            document.getElementById('changeAvatarBtn')?.addEventListener('click', () =>   
                document.getElementById('avatarInput').click()  
            );  
            document.getElementById('avatarInput')?.addEventListener('change', updateAvatar);  

            // 更新用户信息  
            document.getElementById('updateNameBtn')?.addEventListener('click', updateUserName);  
            document.getElementById('updateEmployeeIdBtn')?.addEventListener('click', updateUserEmployeeId);  
        });  

        // 从本地存储加载用户信息  
        function loadUserFromLocalStorage() {  
            const savedUser = localStorage.getItem('currentUser');  
            if (savedUser) {  
                currentUser = JSON.parse(savedUser);  
                isAdmin = ADMIN_EMPLOYEE_IDS.includes(currentUser.employee_id);  
                showMainUI();  
                loadPosts();  
            } else {  
                showUserInfoForm();  
            }  
        }  

        // 保存用户信息到本地存储  
        function saveUserInfo() {  
            const name = document.getElementById('userName').value.trim();  
            const employeeId = document.getElementById('userEmployeeId').value.trim();  
            const avatarFile = document.getElementById('userAvatar').files[0];  
            
            if (!name || !employeeId) {  
                alert('请输入姓名和工号');  
                return;  
            }  
            
            // 创建用户对象  
            currentUser = {  
                name: name,  
                employee_id: employeeId,  
                avatar_url: null,  
                id: Date.now().toString() // 使用时间戳作为临时ID  
            };  
            
            isAdmin = ADMIN_EMPLOYEE_IDS.includes(employeeId);  
            
            // 如果有头像，上传头像  
            if (avatarFile) {  
                uploadImageToImgBB(avatarFile).then(url => {  
                    if (url) {  
                        currentUser.avatar_url = url;  
                        saveUserToLocalStorage();  
                    }  
                });  
            } else {  
                saveUserToLocalStorage();  
            }  
        }  

        // 保存用户到本地存储并更新UI  
        function saveUserToLocalStorage() {  
            localStorage.setItem('currentUser', JSON.stringify(currentUser));  
            showMainUI();  
        }  

        // 显示用户信息输入表单  
        function showUserInfoForm() {  
            document.getElementById('userInfoContainer').classList.remove('hidden');  
            document.getElementById('mainContainer').classList.add('hidden');  
            document.getElementById('userNav').classList.add('hidden');  
            
            // 如果有已保存的用户信息，填充表单  
            if (currentUser) {  
                document.getElementById('userName').value = currentUser.name;  
                document.getElementById('userEmployeeId').value = currentUser.employee_id;  
            }  
        }  

        // 显示主要UI  
        function showMainUI() {  
            document.getElementById('userInfoContainer').classList.add('hidden');  
            document.getElementById('mainContainer').classList.remove('hidden');  
            document.getElementById('userNav').classList.remove('hidden');  
            
            // 更新导航栏用户信息  
            document.getElementById('navUserName').textContent = currentUser.name;  
            if (currentUser.avatar_url) {  
                document.getElementById('navUserAvatar').src = currentUser.avatar_url;  
            }  
            
            // 更新用户个人信息  
            document.getElementById('profileName').textContent = currentUser.name;  
            document.getElementById('profileEmployeeId').textContent = currentUser.employee_id;  
            if (currentUser.avatar_url) {  
                document.getElementById('profileAvatar').src = currentUser.avatar_url;  
            }  
            
            // 显示管理员标识  
            if (isAdmin) {  
                document.getElementById('adminBadge').classList.remove('hidden');  
            } else {  
                document.getElementById('adminBadge').classList.add('hidden');  
            }  
        }  

        // 创建帖子  
        async function createPost(section) {  
            if (!supabase || !currentUser) return;  
            
            const contentElem = document.getElementById(`${section}PostContent`);  
            const imageElem = document.getElementById(`${section}PostImage`);  
            const content = contentElem.value.trim();  
            const imageFile = imageElem.files[0];  
            
            if (!content) {  
                alert('请输入内容');  
                return;  
            }  
            
            let imageUrl = null;  
            
            // 如果有图片，上传到ImgBB  
            if (imageFile) {  
                imageUrl = await uploadImageToImgBB(imageFile);  
                if (!imageUrl) {  
                    alert('图片上传失败');  
                    return;  
                }  
            }  
            
            // 创建帖子  
            const { error } = await supabase  
                .from('posts')  
                .insert({  
                    author_id: currentUser.id,  
                    author_name: currentUser.name, // 添加作者姓名  
                    author_employee_id: currentUser.employee_id, // 添加作者工号  
                    author_avatar: currentUser.avatar_url, // 添加作者头像  
                    content: content,  
                    image_url: imageUrl,  
                    section: section,  
                    is_admin: isAdmin  
                });  
            
            if (error) {  
                console.error('发布失败:', error);  
                alert('发布失败: ' + error.message);  
                return;  
            }  
            
            contentElem.value = '';  
            imageElem.value = '';  
            
            // 重新加载帖子  
            loadPosts();  
        }  

        // 加载帖子  
        async function loadPosts() {  
            if (!supabase) return;  
            
            // 清空现有帖子  
            document.getElementById('techPosts').innerHTML = '';  
            document.getElementById('dailyPosts').innerHTML = '';  
            document.getElementById('userPosts').innerHTML = '';  
            
            // 获取所有帖子  
            const { data: postsData, error } = await supabase  
                .from('posts')  
                .select('*')  
                .order('created_at', { ascending: false });  
            
            if (error) {  
                console.error('获取帖子失败:', error);  
                return;  
            }  
            
            // 渲染帖子  
            postsData.forEach(post => {  
                const postElement = createPostElement(post);  
                
                if (post.section === 'tech') {  
                    document.getElementById('techPosts').appendChild(postElement.cloneNode(true));  
                } else if (post.section === 'daily') {  
                    document.getElementById('dailyPosts').appendChild(postElement.cloneNode(true));  
                }  
                
                // 如果是当前用户的帖子，也添加到用户板块  
                if (currentUser && post.author_employee_id === currentUser.employee_id) {  
                    document.getElementById('userPosts').appendChild(postElement);  
                }  
            });  
            
            // 添加点赞和删除事件  
            attachPostEvents();  
        }  

        // 创建帖子DOM元素  
        function createPostElement(post) {  
            const template = document.getElementById('postTemplate');  
            const postElement = template.content.cloneNode(true).querySelector('.post');  
            
            // 设置帖子ID  
            postElement.dataset.id = post.id;  
            
            // 设置作者信息  
            const avatarElem = postElement.querySelector('.post-avatar');  
            if (post.author_avatar) {  
                avatarElem.src = post.author_avatar;  
            }  
            
            postElement.querySelector('.post-author').textContent = post.author_name;  
            
            // 显示管理员标识  
            if (post.is_admin) {  
                postElement.querySelector('.post-admin-badge').classList.remove('hidden');  
            }  
            
            // 设置发布时间  
            const date = new Date(post.created_at);  
            postElement.querySelector('.post-time').textContent = date.toLocaleString();  
            
            // 设置内容  
            postElement.querySelector('.post-content').textContent = post.content;  
            
            // 如果有图片，显示图片  
            if (post.image_url) {  
                const imageContainer = postElement.querySelector('.post-image-container');  
                const imageElem = postElement.querySelector('.post-image');  
                imageContainer.classList.remove('hidden');  
                imageElem.src = post.image_url;  
            }  
            
            // 设置点赞数  
            postElement.querySelector('.like-count').textContent = post.likes || 0;  
            
            // 如果是当前用户的帖子或管理员，显示删除按钮  
            if (currentUser && (post.author_employee_id === currentUser.employee_id || isAdmin)) {  
                postElement.querySelector('.delete-btn').classList.remove('hidden');  
            }  
            
            return postElement;  
        }  

        // 附加帖子事件（点赞和删除）  
        function attachPostEvents() {  
            // 点赞事件  
            document.querySelectorAll('.like-btn').forEach(btn => {  
                btn.addEventListener('click', async event => {  
                    if (!currentUser) return;  
                    
                    const postElement = event.target.closest('.post');  
                    const postId = postElement.dataset.id;  
                    
                    // 更新点赞数  
                    const { error } = await supabase.rpc('increment_likes', { post_id: postId });  
                    
                    if (error) {  
                        console.error('点赞失败:', error);  
                    } else {  
                        // 直接更新UI，无需等待重新加载  
                        const likeCount = postElement.querySelector('.like-count');  
                        likeCount.textContent = (parseInt(likeCount.textContent) + 1).toString();  
                    }  
                });  
            });  
            
            // 删除事件  
            document.querySelectorAll('.delete-btn').forEach(btn => {  
                btn.addEventListener('click', async event => {  
                    if (!currentUser) return;  
                    
                    const postElement = event.target.closest('.post');  
                    const postId = postElement.dataset.id;  
                    
                    if (confirm('确定要删除这条帖子吗？')) {  
                        // 删除帖子  
                        const { error } = await supabase  
                            .from('posts')  
                            .delete()  
                            .eq('id', postId);  
                        
                        if (error) {  
                            console.error('删除失败:', error);  
                            alert('删除失败: ' + error.message);  
                        } else {  
                            // 直接从DOM中移除帖子元素  
                            const allPostElements = document.querySelectorAll(`.post[data-id="${postId}"]`);  
                            allPostElements.forEach(elem => elem.remove());  
                        }  
                    }  
                });  
            });  
        }  

        // 更新头像  
        async function updateAvatar() {  
            if (!currentUser || !document.getElementById('avatarInput').files.length) return;  
            
            const file = document.getElementById('avatarInput').files[0];  
            const avatarUrl = await uploadImageToImgBB(file);  
            
            if (!avatarUrl) {  
                alert('头像上传失败');  
                return;  
            }  
            
            // 更新当前用户头像  
            currentUser.avatar_url = avatarUrl;  
            localStorage.setItem('currentUser', JSON.stringify(currentUser));  
            
            // 更新UI  
            document.getElementById('profileAvatar').src = avatarUrl;  
            document.getElementById('navUserAvatar').src = avatarUrl;  
            alert('头像更新成功');  
        }  

        // 更新用户名  
        function updateUserName() {  
            if (!currentUser) return;  
            
            const newName = document.getElementById('newName').value.trim();  
            if (!newName) {  
                alert('请输入新的姓名');  
                return;  
            }  
            
            // 更新当前用户姓名  
            currentUser.name = newName;  
            localStorage.setItem('currentUser', JSON.stringify(currentUser));  
            
            // 更新UI  
            document.getElementById('profileName').textContent = newName;  
            document.getElementById('navUserName').textContent = newName;  
            document.getElementById('newName').value = '';  
            alert('姓名更新成功');  
        }  

        // 更新工号  
        function updateUserEmployeeId() {  
            if (!currentUser) return;  
            
            const newEmployeeId = document.getElementById('newEmployeeId').value.trim();  
            if (!newEmployeeId) {  
                alert('请输入新的工号');  
                return;  
            }  
            
            // 更新当前用户工号  
            currentUser.employee_id = newEmployeeId;  
            isAdmin = ADMIN_EMPLOYEE_IDS.includes(newEmployeeId);  
            localStorage.setItem('currentUser', JSON.stringify(currentUser));  
            
            // 更新UI  
            document.getElementById('profileEmployeeId').textContent = newEmployeeId;  
            document.getElementById('newEmployeeId').value = '';  
            
            // 更新管理员标识  
            if (isAdmin) {  
                document.getElementById('adminBadge').classList.remove('hidden');  
            } else {  
                document.getElementById('adminBadge').classList.add('hidden');  
            }  
            
            alert('工号更新成功');  
        }  

        // 将图片上传到ImgBB  
        async function uploadImageToImgBB(file) {  
            const IMGBB_API_KEY = 'b770ca69f1c22b4cd384bdf5bd18d5e2'; // 替换为您的实际API密钥  
            
            const formData = new FormData();  
            formData.append('image', file);  
            formData.append('key', IMGBB_API_KEY);  
            
            try {  
                const response = await fetch('https://api.imgbb.com/1/upload', {  
                    method: 'POST',  
                    body: formData  
                });  
                
                const data = await response.json();  
                
                if (data.success) {  
                    return data.data.url;  
                } else {  
                    console.error('图片上传失败:', data);  
                    return null;  
                }  
            } catch (error) {  
                console.error('图片上传错误:', error);  
                return null;  
            }  
        }  
    </script>  
</body>  
</html>  
